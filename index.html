<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doll Collector</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#111;
    color:#fff;
}

header{
    padding:20px;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
    justify-content:space-between;
    background:#1c1c1c;
}

button{
    padding:8px 14px;
    border:none;
    cursor:pointer;
    border-radius:6px;
}

.primary{background:#ff4fa3;color:#fff;}
.secondary{background:#444;color:#fff;}

.container{
    padding:20px;
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
    gap:20px;
}

.card{
    background:#1c1c1c;
    padding:15px;
    border-radius:10px;
}

.card h3{
    margin-top:0;
}

input, select{
    padding:6px;
    border-radius:6px;
    border:none;
}

.filters{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:20px;
}

.modal{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.8);
    display:none;
    align-items:center;
    justify-content:center;
}

.modal-content{
    background:#1c1c1c;
    padding:20px;
    width:90%;
    max-width:400px;
    border-radius:10px;
    display:flex;
    flex-direction:column;
    gap:10px;
}

.close{
    align-self:flex-end;
    cursor:pointer;
    color:red;
}

.total{
    margin-top:20px;
    font-size:18px;
}

@media(max-width:600px){
    header{flex-direction:column;align-items:flex-start;}
}
</style>
</head>
<body>

<header>
<div>
<button onclick="setLang('ru')" class="secondary">RU</button>
<button onclick="setLang('en')" class="secondary">EN</button>
<select onchange="setCurrency(this.value)">
<option value="CZK">CZK</option>
<option value="USD">USD</option>
<option value="EUR">EUR</option>
<option value="RUB">RUB</option>
<option value="UAH">UAH</option>
</select>
</div>

<div>
<button class="primary" onclick="openModal()">+ Добавить</button>
<button class="secondary" onclick="showSection('catalog')">Каталог</button>
<button class="secondary" onclick="showSection('wishlist')">Вишлист</button>
<button class="secondary" onclick="showSection('collection')">Коллекция</button>
</div>
</header>

<div class="container">

<div class="filters">
<input type="text" id="search" placeholder="Поиск..." oninput="render()">
<select id="brandFilter" onchange="render()">
<option value="">Все фирмы</option>
<option>Monster High</option>
<option>Barbie</option>
<option>Ever After High</option>
</select>
<input type="number" id="maxPrice" placeholder="Макс цена" oninput="render()">
<select onchange="sortPrice(this.value)">
<option value="">Сортировка</option>
<option value="asc">Цена ↑</option>
<option value="desc">Цена ↓</option>
</select>
</div>

<div id="content" class="grid"></div>
<div class="total" id="totalValue"></div>

</div>

<div class="modal" id="modal">
<div class="modal-content">
<span class="close" onclick="closeModal()">X</span>
<input type="text" id="nameInput" placeholder="Название">
<input type="text" id="brandInput" placeholder="Фирма">
<input type="number" id="priceInput" placeholder="Цена">
<button class="primary" onclick="addCustomDoll()">Сохранить</button>
</div>
</div>

<script>

let currency="CZK"
let lang="ru"
let currentSection="catalog"
let sortDirection=""

const rates={
CZK:1,
USD:0.043,
EUR:0.040,
RUB:4,
UAH:1.7
}

let dolls=JSON.parse(localStorage.getItem("dolls"))||[
{id:1,name:"Draculaura Basic G1",brand:"Monster High",price:900},
{id:2,name:"Clawdeen Wolf G3",brand:"Monster High",price:750},
{id:3,name:"Barbie Dreamhouse",brand:"Barbie",price:1200}
]

let wishlist=JSON.parse(localStorage.getItem("wishlist"))||[]
let collection=JSON.parse(localStorage.getItem("collection"))||[]

function save(){
localStorage.setItem("dolls",JSON.stringify(dolls))
localStorage.setItem("wishlist",JSON.stringify(wishlist))
localStorage.setItem("collection",JSON.stringify(collection))
}

function convert(price){
return (price*rates[currency]).toFixed(2)
}

function render(){
let content=document.getElementById("content")
content.innerHTML=""
let search=document.getElementById("search").value.toLowerCase()
let brand=document.getElementById("brandFilter").value
let max=document.getElementById("maxPrice").value

let list=currentSection==="catalog"?dolls:
currentSection==="wishlist"?wishlist:collection

let filtered=list.filter(d=>
d.name.toLowerCase().includes(search) &&
(!brand || d.brand===brand) &&
(!max || d.price<=max)
)

if(sortDirection==="asc") filtered.sort((a,b)=>a.price-b.price)
if(sortDirection==="desc") filtered.sort((a,b)=>b.price-a.price)

filtered.forEach(d=>{
let card=document.createElement("div")
card.className="card"
card.innerHTML=`
<h3>${d.name}</h3>
<p>${d.brand}</p>
<p>${convert(d.price)} ${currency}</p>
${currentSection==="catalog"?
`<button onclick="addToWishlist(${d.id})">♡</button>
<button onclick="addToCollection(${d.id})">+</button>`:""}
`
content.appendChild(card)
})

if(currentSection==="collection"){
let total=collection.reduce((sum,d)=>sum+d.price,0)
document.getElementById("totalValue").innerText=
(lang==="ru"?"Общая стоимость: ":"Total value: ")+convert(total)+" "+currency
}else{
document.getElementById("totalValue").innerText=""
}
}

function addToWishlist(id){
let doll=dolls.find(d=>d.id===id)
if(!wishlist.some(d=>d.id===id)){
wishlist.push(doll)
save()
}
}

function addToCollection(id){
let doll=dolls.find(d=>d.id===id)
if(!collection.some(d=>d.id===id)){
collection.push(doll)
save()
}
}

function openModal(){
document.getElementById("modal").style.display="flex"
}

function closeModal(){
document.getElementById("modal").style.display="none"
}

function addCustomDoll(){
let name=document.getElementById("nameInput").value
let brand=document.getElementById("brandInput").value
let price=document.getElementById("priceInput").value

if(!name||!brand||!price){
alert(lang==="ru"?"Заполни все поля":"Fill all fields")
return
}

let newDoll={
id:Date.now(),
name,
brand,
price:Number(price)
}

dolls.push(newDoll)
save()
closeModal()
render()
}

function setCurrency(c){
currency=c
render()
}

function setLang(l){
lang=l
render()
}

function showSection(sec){
currentSection=sec
render()
}

function sortPrice(dir){
sortDirection=dir
render()
}

render()

</script>
</body>
</html>
